from app.ai.gemini_client import generate_with_gemini

def create_report(patient_name, sessions):
    # איסוף ההערות מהטיפולים
    all_notes = " ".join([s.get('notes', '') for s in sessions])
    
    # הפרומפט המקצועי עם המבנה המדויק שביקשת
    prompt = f"""
    אתה קלינאי תקשורת מומחה. עליך לכתוב דוח סיכום טיפול ובקשה להמשך טיפול מקצועי בעברית.
    
    נתוני המטופל:
    שם: {patient_name}
    הערות קליניות: {all_notes}
    
    עליך לכתוב את הדוח בדיוק במבנה הבא:

    בס"ד
    בקשת המשך טיפול שפה ודיבור
    תאריך: [תאריך של היום]
    שם מטופל: {patient_name}
    ת.ז.: [השאר ריק למילוי]
    תאריך לידה: [השאר ריק למילוי]
    גיל: [הסק מההערות או השאר ריק]
    מסגרת חינוכית: גן 
    מספר טיפולים שנעשו: [השאר ריק]
    
    רקע כללי:
    [תאר את הרקע המשפחתי והשפתי על בסיס ההערות]

    סיבת הפנייה:
    [פרט את קשיי השפה והדיבור]

    סיכום אבחון שפה:
    [סכם את הממצאים העיקריים]

    תפקוד נוכחי לפי דיווח ההורים והמטפל:
    [תיאור היכולות כיום]

    מטרות טיפוליות:
    [פרט 4-5 מטרות שעבדתם עליהן]

    מהלך הטיפול:
    [תאר את שיתוף הפעולה, המוטיבציה וההתקדמות]

    בקשה להמשך טיפול:
    [הסבר מדוע נדרשים עוד 12 טיפולים ומהם המוקדים העיקריים להמשך]
    
    המלצות להמשך:
    המשך מעקב א.א.ג.

    בכבוד רב,
    [שם המטפל/ת]
    קלינאי/ת תקשורת
    """
    
    return generate_with_gemini(prompt)